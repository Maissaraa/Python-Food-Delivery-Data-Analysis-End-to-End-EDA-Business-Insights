# ================= VISUALIZATION ==================
def visualize_data(df):
    """
    Create visualizations to explore the dataset:
    - Revenue by state (bar chart)
    - Orders by hour of the day (line chart)
    - Correlation heatmap for numeric features
    Helps to identify trends, patterns, and relationships in the data.
    """
    
    # Revenue by state
    plt.figure()
    df.groupby("state")["total_amount"].sum().plot(kind="bar")
    plt.title("Revenue by State")
    plt.xticks(rotation=45)
    plt.tight_layout()
    plt.show()

    # Orders by hour
    plt.figure()
    sns.lineplot(
        x=df.groupby("order_hour")["order_id"].count().index,
        y=df.groupby("order_hour")["order_id"].count().values
    )
    plt.title("Orders by Hour")
    plt.show()

    # Correlation heatmap
    plt.figure()
    sns.heatmap(
        df.select_dtypes(include=np.number).corr(),
        annot=False
    )
    plt.title("Correlation Matrix")
    plt.show()

def plot_interactive(df):
    """Create interactive plots with plotly"""
    
    print("\nCreating interactive visualizations...")
    
    # 1. Revenue by state - interactive bar
    state_rev = df.groupby("state")["total_amount"].sum().sort_values(ascending=True).tail(10)
    fig1 = px.bar(
        x=state_rev.values,
        y=state_rev.index,
        orientation='h',
        title="Top 10 States by Revenue",
        labels={'x': 'Revenue ($)', 'y': 'State'},
        color=state_rev.values,
        color_continuous_scale='Blues'
    )
    fig1.write_html("revenue_by_state.html")
    fig1.show()
    
    # 2. Delivery scatter plot
    sample_df = df.sample(min(500, len(df)))
    fig2 = px.scatter(
        sample_df,
        x='delivery_distance_km',
        y='delivery_time_minutes',
        color='delivery_mode',
        size='order_value',
        title="Delivery Time vs Distance",
        labels={'delivery_distance_km': 'Distance (km)', 'delivery_time_minutes': 'Time (minutes)'}
    )
    fig2.write_html("delivery_analysis.html")
    fig2.show()
    
    print("Interactive dashboards saved")
